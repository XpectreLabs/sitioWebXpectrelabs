<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta http-equiv="Permissions-Policy" content="
        payment=(),
        interest-cohort=(),
        geolocation=(),
        microphone=(),
        camera=()
    ">
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Book your 30-min Diagnostic Call</title>
<link href="https://fonts.googleapis.com/css2?family=PT+Sans&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:#0B0F1A;
    --gold:#DCA500;
    --ink:#FFFFFF;
    --panel:#0B0F1A;
    --radius:20px;
    --shadow:0 10px 30px rgba(0,0,0,.45);
  }

  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    font-family:'PT Sans', system-ui, sans-serif;
    color:var(--ink);
    background-color:var(--bg);
    overflow-x:hidden;
    position:relative;
  }

  .wrap{max-width:820px;margin:0 auto;padding:56px 20px 80px;position:relative;z-index:2;}

  body::before{
    content:""; position:fixed; top:50%; left:50%; width:800px; height:800px;
    background:url('assets/logo-mark.png') no-repeat center/contain;
    opacity:0.15; transform:translate(-50%,-50%); z-index:0; pointer-events:none;
    filter:brightness(1.3) contrast(1.1); mix-blend-mode:lighten;
  }

  .heading{font-family:'Space Grotesk',sans-serif;margin:0 0 6px;font-size:clamp(26px,2.2vw + 18px,38px);text-align:center;}
  .promise{margin:0 0 22px;color:#b5bbc6;font-family:'PT Sans',sans-serif;font-size:15px;text-align:center;}
  .promise strong{color:var(--gold);font-weight:700}

  .hero-octo{display:block;width:96px;height:auto;margin:0 auto 28px;filter:drop-shadow(0 6px 18px rgba(217,176,77,.25));animation:float 6s ease-in-out infinite;position:relative;z-index:3;}
  @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}

  .card{position:relative;background:var(--panel);border-radius:var(--radius);border:1px solid rgba(255,255,255,.08);box-shadow:var(--shadow);overflow:hidden;z-index:2;}
  form{padding:28px}
  .field{position:relative;margin-bottom:18px}
  .input,.select,.textarea{
    width:100%; border-radius:14px; color:var(--ink);
    background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.15);
    padding:16px 14px; outline:none; transition:border-color .2s, box-shadow .2s, background .2s, transform .06s;
    font-family:'PT Sans',sans-serif;
  }
  .input:focus,.select:focus,.textarea:focus{border-color:var(--gold); box-shadow:0 0 8px rgba(220,165,0,.4); background:rgba(255,255,255,.06)}
  .textarea{min-height:130px;resize:vertical}

  /* Fix contraste del <select> y sus opciones */
  .select{color:#000; background:#fff;}              /* texto negro fondo blanco para máxima legibilidad */
  .select option{background:#0B0F1A; color:#FFFFFF;} /* menú desplegable oscuro y texto blanco */

  .label{
    position:absolute; left:14px; top:12px; padding:0 6px; color:#b5bbc6; font-size:14px;
    pointer-events:none; background:var(--panel);
    transition:transform .15s ease,color .15s ease,font-size .15s ease,top .15s;
  }
  .input:focus + .label,
  .textarea:focus + .label,
  .input:not(:placeholder-shown) + .label,
  .textarea:not(:placeholder-shown) + .label{top:-7px;font-size:12px;color:var(--gold);}
  .select + .label{top:-7px;font-size:12px;color:#b5bbc6;}
  .select:focus + .label, .select:valid + .label{color:var(--gold);}

  .actions{display:flex;gap:12px;align-items:center;margin-top:18px;flex-wrap:wrap;justify-content:center;}
  .btn-primary{
    background:white; color:var(--gold); border:none; border-radius:40px; padding:14px 28px;
    font-weight:700; font-family:'Space Grotesk',sans-serif; cursor:pointer; transition:all .25s ease; box-shadow:0 0 0 rgba(220,165,0,0);
  }
  .btn-primary:hover{box-shadow:0 0 16px rgba(220,165,0,0.6); transform:translateY(-1px);}
  .btn-outline{
    background:transparent; border:2px solid var(--gold); color:var(--gold); border-radius:40px; padding:12px 26px;
    font-weight:700; font-family:'Space Grotesk',sans-serif; cursor:pointer; transition:all .25s ease;
  }
  .btn-outline:hover{background:var(--gold); color:#111; box-shadow:0 0 12px rgba(220,165,0,0.6);}

  .calendly-wrap{display:none;margin:18px 0 0;border-top:1px dashed rgba(255,255,255,.12);padding-top:18px}
  .calendly-iframe{width:100%;height:720px;border:0;border-radius:14px;background:#0d0d0d}

  /* Footer compacto (Home, Why, Events, Insights) */
  .footer{--muted:#9AA0A6; --muted-2:#8C8F96; --gold-hi:#F0C75E; background:var(--bg); color:var(--muted); border-top:1px solid rgba(255,255,255,.06); padding:28px 0 20px; font:500 14px/1.45 'PT Sans', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;}
  .footer .wrap{max-width:1080px;margin:0 auto;padding:0 20px;}
  .footer-grid{display:grid;gap:12px 16px;grid-template-columns:1.2fr auto auto;align-items:center;}
  @media (max-width:840px){.footer-grid{grid-template-columns:1fr;text-align:center;}}
  .footer .logo{margin:0 0 2px;font:700 18px "Space Grotesk", Inter, sans-serif;color:var(--ink);letter-spacing:.02em;}
  .footer .tag{margin:0;font-size:12px;color:#C9CED6;}
  .footer .links,.footer .social{display:flex;gap:12px;flex-wrap:wrap;}
  .footer .links a,.footer .social a{color:var(--gold);text-decoration:none;transition:color .2s ease,opacity .2s ease;white-space:nowrap;font-weight:600;}
  .footer .links a:hover,.footer .social a:hover{color:var(--gold-hi);}
  .footer .copy{margin:12px 0 0;text-align:center;font-size:12px;color:var(--muted-2);}

  @media (max-width:640px){
    .wrap{padding:36px 16px 64px}
    form{padding:22px}
    .calendly-iframe{height:680px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <img class="hero-octo" src="assets/logo-mark.png" alt="Xpectre Labs octopus" />
    <h1 class="heading">Book your 30-min Diagnostic Call</h1>
    <p class="promise"><strong>We’ll reply within 24 hours.</strong></p>

    <div class="card">
      <form id="leadForm" novalidate>
        <div class="field">
          <input class="input" id="fullName" name="fullName" type="text" required placeholder=" " autocomplete="name" />
          <label class="label" for="fullName">Full Name *</label>
        </div>

        <div class="field">
          <input class="input" id="workEmail" name="workEmail" type="email" required placeholder=" " autocomplete="email" />
          <label class="label" for="workEmail">Work Email *</label>
        </div>

        <div class="field">
          <input class="input" id="company" name="company" type="text" required placeholder=" " autocomplete="organization" />
          <label class="label" for="company">Company / Startup Name *</label>
        </div>

        <div class="field">
          <input class="input" id="role" name="role" type="text" placeholder=" " autocomplete="organization-title" />
          <label class="label" for="role">Role / Title (optional)</label>
        </div>

        <div class="field">
          <select class="select" id="interest" name="interest" required>
            <option value="" disabled selected hidden>Select one option</option>
            <option>Software Development</option>
            <option>Staff Augmentation</option>
            <option>3D Prototyping</option>
            <option>Strategy &amp; Innovation Sprint</option>
          </select>
          <label class="label" for="interest">Interest / Area of Support *</label>
        </div>

        <div class="field">
          <textarea class="textarea" id="message" name="message" placeholder=" "></textarea>
          <label class="label" for="message">Tell us what you’d like to improve</label>
        </div>

        <!-- reCAPTCHA v2 checkbox con tu SITE KEY -->
        <div class="field" style="display:flex;justify-content:center;margin-top:6px;">
          <div class="g-recaptcha" data-sitekey="6LfjhforAAAAAH8J83wFyvzrrnKpqa3Ix3hZb-0P"></div>
        </div>

        <div class="actions">
          <button type="button" class="btn-primary" id="bookBtn">Book your call</button>
          <button type="button" class="btn-outline" onclick="window.location.href='https://xpectrelabs.com/';">← Back to site</button>
        </div>

        <div class="calendly-wrap" id="calWrapper">
          <iframe id="calFrame" class="calendly-iframe" title="Schedule your call"></iframe>
        </div>
      </form>
    </div>
  </div>

  <!-- ===== Footer ===== -->
  <footer class="footer" role="contentinfo">
    <div class="wrap">
      <div class="footer-grid">
        <div class="brand">
          <h3 class="logo">Xpectre Labs</h3>
          <p class="tag">Prototyping the next wave of digital infrastructure.</p>
        </div>
        <nav class="links" aria-label="Sections">
          <a href="https://xpectrelabs.com/">Home</a>
          <a href="https://xpectrelabs.com/#why">Why Xpectre</a>
          <a href="https://xpectrelabs.com/events.html">Events</a>
          <a href="https://xpectrelabs.com/blog.html">Insights from the Lab</a>
        </nav>
        <nav class="social" aria-label="Social">
          <a href="https://instagram.com/xpectrelabs" target="_blank" rel="noopener">Instagram</a>
          <a href="https://linkedin.com/company/xpectrelabs" target="_blank" rel="noopener">LinkedIn</a>
          <a href="mailto:contact@xpectrelabs.com">Email</a>
        </nav>
      </div>
      <p class="copy">© 2025 Xpectre Labs. All rights reserved.</p>
    </div>
  </footer>

  <!-- reCAPTCHA loader -->
  <script src="https://www.google.com/recaptcha/api.js" async defer></script>

  <!-- Calendly -->
  <script src="https://assets.calendly.com/assets/external/widget.js" async></script>

<!-- APP LOGIC -->
<script>
        const freemail = /@(gmail|yahoo|outlook|hotmail|icloud|protonmail|aol)\./i;
        const CALENDLY_EVENT_URL = "https://calendly.com/ais-ia-contacto/30min";

        // ✅ URL del script PHP
        const ENDPOINT = "enviar_correo.php";

        function getRecaptchaToken(){
        const widget = document.querySelector('.g-recaptcha');
        if(!widget) return null;
        try { 
            return grecaptcha.getResponse(); 
        } catch(e){ 
            return null; 
        }
        }

        // ✅ Función para resetear completamente el formulario
        function resetFormCompletely() {
        const form = document.getElementById('leadForm');
        if (!form) return;
        
        // 1. Resetear el formulario
        form.reset();
        
        // 2. Resetear reCAPTCHA
        if (window.grecaptcha && grecaptcha.reset) {
            grecaptcha.reset();
        }
        
        // 3. Resetear manualmente los labels
        const labels = document.querySelectorAll('.label');
        labels.forEach(label => {
            const input = document.getElementById(label.htmlFor);
            if (input && (input.value === '' || input.value === null || input.value === undefined)) {
            label.style.transform = '';
            label.style.fontSize = '';
            label.style.top = '12px';
            label.style.color = '#b5bbc6';
            }
        });
        
        // 4. Forzar el estado inicial del select
        const select = document.getElementById('interest');
        if (select) {
            select.selectedIndex = 0;
            const selectLabel = document.querySelector('label[for="interest"]');
            if (selectLabel) {
            selectLabel.style.top = '12px';
            selectLabel.style.fontSize = '14px';
            selectLabel.style.color = '#b5bbc6';
            }
        }
        }

        // ✅ Función para mostrar mensaje de éxito
        function showSuccessMessage() {
        const successMessage = document.getElementById('successMessage');
        if (successMessage) {
            successMessage.style.display = 'block';
            
            // Ocultar el mensaje después de 5 segundos
            setTimeout(() => {
            successMessage.style.display = 'none';
            }, 5000);
        }
        }

        // ✅ Función mejorada para enviar el formulario
        async function submitForm() {
        const required = ['fullName','workEmail','company','interest'];
        for(const id of required){
            const el = document.getElementById(id);
            if(!el.value){ 
            el.focus(); 
            el.reportValidity?.(); 
            return false; 
            }
        }

        const email = document.getElementById('workEmail').value.trim();
        if(freemail.test(email)){
            if(!confirm("This looks like a personal email. Continue anyway?")) return false;
        }

        const name = document.getElementById('fullName').value.trim();
        const company = document.getElementById('company').value.trim();
        const role = document.getElementById('role').value.trim();
        const interest = document.getElementById('interest').value;
        const msg = document.getElementById('message').value.trim();

        const recaptcha = getRecaptchaToken();
        if(!recaptcha){
            alert('Please complete the reCAPTCHA.');
            return false;
        }

        const bookBtn = document.getElementById('bookBtn');
        const originalText = bookBtn.textContent;
        
        // ✅ Mostrar loading state
        bookBtn.textContent = 'Sending...';
        bookBtn.disabled = true;

        try {
            // ✅ Usar FormData en lugar de URLSearchParams para mejor compatibilidad
            const formData = new FormData();
            formData.append('fullName', name);
            formData.append('workEmail', email);
            formData.append('company', company);
            formData.append('role', role);
            formData.append('interest', interest);
            formData.append('message', msg);

            // ✅ Usar fetch en lugar de XMLHttpRequest para mejor manejo de promesas
            const response = await fetch(ENDPOINT, {
            method: 'POST',
            body: formData
            });

            const data = await response.json();
            
            // Restaurar botón
            bookBtn.textContent = originalText;
            bookBtn.disabled = false;
            
            if (!data.ok) {
            alert(data.error || 'Submission failed. Try again.');
            return false;
            }
            
            console.log('Success:', data);
            
            // ✅ RESETEAR FORMULARIO COMPLETAMENTE
            resetFormCompletely();
            
            // ✅ MOSTRAR MENSAJE DE ÉXITO
            showSuccessMessage();
            
            // ✅ Abrir Calendly en nueva pestaña para evitar problemas de scroll
            const params = new URLSearchParams({
            name, 
            email, 
            a_company: company, 
            a_role: role, 
            a_interest: interest, 
            a_message: msg
            });
            
            const url = CALENDLY_EVENT_URL + "?" + params.toString();

            // ✅ Siempre abrir en nueva pestaña para evitar problemas de DOM
            window.open(url, '_blank');
            
            return true;
            
        } catch(err) {
            // Restaurar botón en caso de error
            bookBtn.textContent = originalText;
            bookBtn.disabled = false;
            
            console.error('Error:', err);
            alert('Error: ' + err.message);
            return false;
        }
        }

        // ✅ Event listener mejorado
        document.addEventListener('DOMContentLoaded', function() {
        const bookBtn = document.getElementById('bookBtn');
        if (bookBtn) {
            bookBtn.addEventListener('click', function(event) {
            // ✅ Prevenir comportamiento por defecto inmediatamente
            event.preventDefault();
            event.stopPropagation();
            
            // ✅ Usar setTimeout para liberar el event loop
            setTimeout(async () => {
                await submitForm();
            }, 10);
            });
        }

        // ✅ También manejar el evento submit del formulario por si acaso
        const leadForm = document.getElementById('leadForm');
        if (leadForm) {
            leadForm.addEventListener('submit', function(event) {
            event.preventDefault();
            event.stopPropagation();
            
            setTimeout(async () => {
                await submitForm();
            }, 10);
            });
        }
        });

        // ✅ Asegurar que el scroll siempre funcione
        document.addEventListener('wheel', function(e) {
        // Forzar que los eventos de scroll siempre se procesen
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
        // Forzar que los eventos táctiles siempre se procesen  
        }, { passive: true });
        </script>
</body>
</html>
